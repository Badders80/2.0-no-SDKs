"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const $e=require("@polkadot/api"),v=require("@polkadot/util"),W=require("@polkadot/util-crypto"),A=require("viem"),I=require("ripple-binary-codec"),z=require("ripple-keypairs"),Z=require("@polkadot/util-crypto/ethereum"),O=require("blakejs"),H=require("xrpl"),G=require("@futureverse/signer-core");function J(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Ee(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function C(t,...e){if(!Ee(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Q(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Pe(t,e){C(t);const n=e.outputLen;if(t.length<n)throw new Error("digestInto() expects output buffer of length at least "+n)}const T=BigInt(2**32-1),Y=BigInt(32);function ve(t,e=!1){return e?{h:Number(t&T),l:Number(t>>Y&T)}:{h:Number(t>>Y&T)|0,l:Number(t&T)|0}}function Ie(t,e=!1){let n=new Uint32Array(t.length),s=new Uint32Array(t.length);for(let r=0;r<t.length;r++){const{h:i,l:o}=ve(t[r],e);[n[r],s[r]]=[i,o]}return[n,s]}const Te=(t,e,n)=>t<<n|e>>>32-n,Me=(t,e,n)=>e<<n|t>>>32-n,_e=(t,e,n)=>e<<n-32|t>>>64-n,ke=(t,e,n)=>t<<n-32|e>>>64-n;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Ue(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}const ee=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Oe(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}function te(t){for(let e=0;e<t.length;e++)t[e]=Oe(t[e])}typeof Uint8Array.from([]).toHex=="function"&&Uint8Array.fromHex;function Re(t){if(typeof t!="string")throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array(new TextEncoder().encode(t))}function ue(t){return typeof t=="string"&&(t=Re(t)),C(t),t}class Le{clone(){return this._cloneInto()}}function He(t){const e=s=>t().update(ue(s)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}const de=[],le=[],fe=[],Be=BigInt(0),E=BigInt(1),ze=BigInt(2),Ce=BigInt(7),De=BigInt(256),je=BigInt(113);for(let t=0,e=E,n=1,s=0;t<24;t++){[n,s]=[s,(2*n+3*s)%5],de.push(2*(5*s+n)),le.push((t+1)*(t+2)/2%64);let r=Be;for(let i=0;i<7;i++)e=(e<<E^(e>>Ce)*je)%De,e&ze&&(r^=E<<(E<<BigInt(i))-E);fe.push(r)}const[Fe,Ne]=Ie(fe,!0),ne=(t,e,n)=>n>32?_e(t,e,n):Te(t,e,n),se=(t,e,n)=>n>32?ke(t,e,n):Me(t,e,n);function qe(t,e=24){const n=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let o=0;o<10;o++)n[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,u=n[c],d=n[c+1],f=ne(u,d,1)^n[a],w=se(u,d,1)^n[a+1];for(let y=0;y<50;y+=10)t[o+y]^=f,t[o+y+1]^=w}let r=t[2],i=t[3];for(let o=0;o<24;o++){const a=le[o],c=ne(r,i,a),u=se(r,i,a),d=de[o];r=t[d],i=t[d+1],t[d]=c,t[d+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)n[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~n[(a+2)%10]&n[(a+4)%10]}t[0]^=Fe[s],t[1]^=Ne[s]}n.fill(0)}class D extends Le{constructor(e,n,s,r=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=n,this.outputLen=s,this.enableXOF=r,this.rounds=i,J(s),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=Ue(this.state)}keccak(){ee||te(this.state32),qe(this.state32,this.rounds),ee||te(this.state32),this.posOut=0,this.pos=0}update(e){Q(this);const{blockLen:n,state:s}=this;e=ue(e);const r=e.length;for(let i=0;i<r;){const o=Math.min(n-this.pos,r-i);for(let a=0;a<o;a++)s[this.pos++]^=e[i++];this.pos===n&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:n,pos:s,blockLen:r}=this;e[s]^=n,(n&128)!==0&&s===r-1&&this.keccak(),e[r-1]^=128,this.keccak()}writeInto(e){Q(this,!1),C(e),this.finish();const n=this.state,{blockLen:s}=this;for(let r=0,i=e.length;r<i;){this.posOut>=s&&this.keccak();const o=Math.min(s-this.posOut,i-r);e.set(n.subarray(this.posOut,this.posOut+o),r),this.posOut+=o,r+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return J(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Pe(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:n,suffix:s,outputLen:r,rounds:i,enableXOF:o}=this;return e||(e=new D(n,s,r,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=s,e.outputLen=r,e.enableXOF=o,e.destroyed=this.destroyed,e}}const Ke=(t,e,n)=>He(()=>new D(e,t,n)),Xe=Ke(1,136,256/8);function j(t,{strict:e=!0}={}){return!t||typeof t!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(t):t.startsWith("0x")}const ge="2.29.0";let P={getDocsUrl:({docsBaseUrl:t,docsPath:e="",docsSlug:n})=>e?`${t??"https://viem.sh"}${e}${n?`#${n}`:""}`:void 0,version:`viem@${ge}`};class h extends Error{constructor(e,n={}){var a;const s=(()=>{var c;return n.cause instanceof h?n.cause.details:(c=n.cause)!=null&&c.message?n.cause.message:n.details})(),r=n.cause instanceof h&&n.cause.docsPath||n.docsPath,i=(a=P.getDocsUrl)==null?void 0:a.call(P,{...n,docsPath:r}),o=[e||"An error occurred.","",...n.metaMessages?[...n.metaMessages,""]:[],...i?[`Docs: ${i}`]:[],...s?[`Details: ${s}`]:[],...P.version?[`Version: ${P.version}`]:[]].join(`
`);super(o,n.cause?{cause:n.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=s,this.docsPath=r,this.metaMessages=n.metaMessages,this.name=n.name??this.name,this.shortMessage=e,this.version=ge}walk(e){return he(this,e)}}function he(t,e){return e!=null&&e(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause!==void 0?he(t.cause,e):e?null:t}class ye extends h{constructor({size:e,targetSize:n,type:s}){super(`${s.charAt(0).toUpperCase()}${s.slice(1).toLowerCase()} size (${e}) exceeds padding size (${n}).`,{name:"SizeExceedsPaddingSizeError"})}}function k(t,{dir:e,size:n=32}={}){return typeof t=="string"?Ve(t,{dir:e,size:n}):We(t,{dir:e,size:n})}function Ve(t,{dir:e,size:n=32}={}){if(n===null)return t;const s=t.replace("0x","");if(s.length>n*2)throw new ye({size:Math.ceil(s.length/2),targetSize:n,type:"hex"});return`0x${s[e==="right"?"padEnd":"padStart"](n*2,"0")}`}function We(t,{dir:e,size:n=32}={}){if(n===null)return t;if(t.length>n)throw new ye({size:t.length,targetSize:n,type:"bytes"});const s=new Uint8Array(n);for(let r=0;r<n;r++){const i=e==="right";s[i?r:n-r-1]=t[i?r:t.length-r-1]}return s}class Ze extends h{constructor({max:e,min:n,signed:s,size:r,value:i}){super(`Number "${i}" is not in safe ${r?`${r*8}-bit ${s?"signed":"unsigned"} `:""}integer range ${e?`(${n} to ${e})`:`(above ${n})`}`,{name:"IntegerOutOfRangeError"})}}class Ge extends h{constructor({givenSize:e,maxSize:n}){super(`Size cannot exceed ${n} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function re(t){return j(t,{strict:!1})?Math.ceil((t.length-2)/2):t.length}function F(t,{size:e}){if(re(t)>e)throw new Ge({givenSize:re(t),maxSize:e})}function Je(t,e={}){const{signed:n,size:s}=e,r=BigInt(t);let i;s?n?i=(1n<<BigInt(s)*8n-1n)-1n:i=2n**(BigInt(s)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&n?-i-1n:0;if(i&&r>i||r<o){const c=typeof t=="bigint"?"n":"";throw new Ze({max:i?`${i}${c}`:void 0,min:`${o}${c}`,signed:n,size:s,value:`${t}${c}`})}const a=`0x${(n&&r<0?(1n<<BigInt(s*8))+BigInt(r):r).toString(16)}`;return s?k(a,{size:s}):a}const Qe=new TextEncoder;function Ye(t,e={}){return typeof t=="number"||typeof t=="bigint"?tt(t,e):typeof t=="boolean"?et(t,e):j(t)?me(t,e):pe(t,e)}function et(t,e={}){const n=new Uint8Array(1);return n[0]=Number(t),typeof e.size=="number"?(F(n,{size:e.size}),k(n,{size:e.size})):n}const g={zero:48,nine:57,A:65,F:70,a:97,f:102};function ie(t){if(t>=g.zero&&t<=g.nine)return t-g.zero;if(t>=g.A&&t<=g.F)return t-(g.A-10);if(t>=g.a&&t<=g.f)return t-(g.a-10)}function me(t,e={}){let n=t;e.size&&(F(n,{size:e.size}),n=k(n,{dir:"right",size:e.size}));let s=n.slice(2);s.length%2&&(s=`0${s}`);const r=s.length/2,i=new Uint8Array(r);for(let o=0,a=0;o<r;o++){const c=ie(s.charCodeAt(a++)),u=ie(s.charCodeAt(a++));if(c===void 0||u===void 0)throw new h(`Invalid byte sequence ("${s[a-2]}${s[a-1]}" in "${s}").`);i[o]=c*16+u}return i}function tt(t,e){const n=Je(t,e);return me(n)}function pe(t,e={}){const n=Qe.encode(t);return typeof e.size=="number"?(F(n,{size:e.size}),k(n,{dir:"right",size:e.size})):n}function nt(t,e){return Xe(j(t,{strict:!1})?Ye(t):t)}class st extends h{constructor({address:e}){super(`Address "${e}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}class we extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const n=super.get(e);return super.has(e)&&n!==void 0&&(this.delete(e),super.set(e,n)),n}set(e,n){if(super.set(e,n),this.maxSize&&this.size>this.maxSize){const s=this.keys().next().value;s&&this.delete(s)}return this}}const R=new we(8192);function xe(t,e){if(R.has(`${t}.${e}`))return R.get(`${t}.${e}`);const n=t.substring(2).toLowerCase(),s=nt(pe(n)),r=n.split("");for(let o=0;o<40;o+=2)s[o>>1]>>4>=8&&r[o]&&(r[o]=r[o].toUpperCase()),(s[o>>1]&15)>=8&&r[o+1]&&(r[o+1]=r[o+1].toUpperCase());const i=`0x${r.join("")}`;return R.set(`${t}.${e}`,i),i}function rt(t,e){if(!ot(t,{strict:!1}))throw new st({address:t});return xe(t,e)}const it=/^0x[a-fA-F0-9]{40}$/,L=new we(8192);function ot(t,e){const{strict:n=!0}=e??{},s=`${t}.${n}`;if(L.has(s))return L.get(s);const r=it.test(t)?t.toLowerCase()===t?!0:n?xe(t)===t:!0:!1;return L.set(s,r),r}class p extends h{constructor(e){const{docsPath:n,field:s,metaMessages:r}=e;super(`Invalid Sign-In with Ethereum message field "${s}".`,{docsPath:n,metaMessages:r,name:"SiweInvalidMessageFieldError"})}}function oe(t){if(/[^a-z0-9\:\/\?\#\[\]\@\!\$\&\'\(\)\*\+\,\;\=\.\-\_\~\%]/i.test(t)||/%[^0-9a-f]/i.test(t)||/%[0-9a-f](:?[^0-9a-f]|$)/i.test(t))return!1;const e=at(t),n=e[1],s=e[2],r=e[3],i=e[4],o=e[5];if(!(n!=null&&n.length&&r.length>=0))return!1;if(s!=null&&s.length){if(!(r.length===0||/^\//.test(r)))return!1}else if(/^\/\//.test(r))return!1;if(!/^[a-z][a-z0-9\+\-\.]*$/.test(n.toLowerCase()))return!1;let a="";return a+=`${n}:`,s!=null&&s.length&&(a+=`//${s}`),a+=r,i!=null&&i.length&&(a+=`?${i}`),o!=null&&o.length&&(a+=`#${o}`),a}function at(t){return t.match(/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/)}function ct(t){const{chainId:e,domain:n,expirationTime:s,issuedAt:r=new Date,nonce:i,notBefore:o,requestId:a,resources:c,scheme:u,uri:d,version:f}=t;{if(e!==Math.floor(e))throw new p({field:"chainId",metaMessages:["- Chain ID must be a EIP-155 chain ID.","- See https://eips.ethereum.org/EIPS/eip-155","",`Provided value: ${e}`]});if(!(ut.test(n)||dt.test(n)||lt.test(n)))throw new p({field:"domain",metaMessages:["- Domain must be an RFC 3986 authority.","- See https://www.rfc-editor.org/rfc/rfc3986","",`Provided value: ${n}`]});if(!ft.test(i))throw new p({field:"nonce",metaMessages:["- Nonce must be at least 8 characters.","- Nonce must be alphanumeric.","",`Provided value: ${i}`]});if(!oe(d))throw new p({field:"uri",metaMessages:["- URI must be a RFC 3986 URI referring to the resource that is the subject of the signing.","- See https://www.rfc-editor.org/rfc/rfc3986","",`Provided value: ${d}`]});if(f!=="1")throw new p({field:"version",metaMessages:["- Version must be '1'.","",`Provided value: ${f}`]});if(u&&!gt.test(u))throw new p({field:"scheme",metaMessages:["- Scheme must be an RFC 3986 URI scheme.","- See https://www.rfc-editor.org/rfc/rfc3986#section-3.1","",`Provided value: ${u}`]});const x=t.statement;if(x!=null&&x.includes(`
`))throw new p({field:"statement",metaMessages:["- Statement must not include '\\n'.","",`Provided value: ${x}`]})}const w=rt(t.address),y=u?`${u}://${n}`:n,m=t.statement?`${t.statement}
`:"",Ae=`${y} wants you to sign in with your Ethereum account:
${w}

${m}`;let $=`URI: ${d}
Version: ${f}
Chain ID: ${e}
Nonce: ${i}
Issued At: ${r.toISOString()}`;if(s&&($+=`
Expiration Time: ${s.toISOString()}`),o&&($+=`
Not Before: ${o.toISOString()}`),a&&($+=`
Request ID: ${a}`),c){let x=`
Resources:`;for(const U of c){if(!oe(U))throw new p({field:"resources",metaMessages:["- Every resource must be a RFC 3986 URI.","- See https://www.rfc-editor.org/rfc/rfc3986","",`Provided value: ${U}`]});x+=`
- ${U}`}$+=x}return`${Ae}
${$}`}const ut=/^([a-zA-Z0-9]([a-zA-Z0-9\-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}(:[0-9]{1,5})?$/,dt=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)(:[0-9]{1,5})?$/,lt=/^localhost(:[0-9]{1,5})?$/,ft=/^[a-zA-Z0-9]{8,}$/,gt=/^([a-zA-Z][a-zA-Z0-9+-.]*)$/,B=256;let M=B,_;function ht(t=11){if(!_||M+t>B*2){_="",M=0;for(let e=0;e<B;e++)_+=(256+Math.random()*256|0).toString(16).substring(1)}return _.substring(M,M+++t)}function yt(){return ht(96)}class l{async signPassOIDC(e){if(!e.address)throw new Error("Address required");const n=yt(),s=new Date,r=A.getAddress(e.address),i=ct({version:"1",nonce:n,address:r,uri:e.idpURL,domain:e.domain,chainId:e.chainId,issuedAt:s}),o=await this.signMessage(i);if(o==null)throw new Error("Failed to sign auth message");return{hint:"eoa:"+new URLSearchParams({nonce:n,address:r,issuedAt:s.toISOString(),domain:e.domain,signature:o}).toString(),nonce:n}}static async verifySignature(e,n){return{ethAddress:await A.recoverMessageAddress({message:e,signature:n})}}verifySignature(e,n){return l.verifySignature(e,n)}async signExtrinsic(e,n,s){const r=await this.createExtrinsicPayload(e,s,n),i=await this.signPayload(r);return n.addSignature(s,i,r.trnPayload.toPayload())}async signPayload(e,n){const r={raw:e.ethPayload.toString()},i={transaction:n==null?void 0:n.toHex()},o=await this.signMessage(r,i);if(!be(o))throw new Error('Expected signature to start with "0x"');return o}async signExtrinsicWithPayload(e,n,s,r){const i=await this.signPayload(s,n);return n.addSignature(r,i,s.trnPayload.toPayload())}async createExtrinsicPayload(e,n,s,r){const{header:i,mortalLength:o,nonce:a}=await e.derive.tx.signingInfo(n),c={address:n,blockHash:i==null?void 0:i.hash,blockNumber:i==null?void 0:i.number,era:e.registry.createTypeUnsafe("ExtrinsicEra",[{current:i==null?void 0:i.number,period:o}]),genesisHash:e.genesisHash,method:s.method,nonce:a,runtimeVersion:e.runtimeVersion,signedExtensions:e.registry.signedExtensions,version:e.extrinsicVersion,...r},u=e.registry.createTypeUnsafe("SignerPayload",[c]),{data:d}=u.toRaw(),f=d.length>257*2?W.blake2AsHex(d):d,w=W.blake2AsHex(f);return{trnPayload:u,ethPayload:w}}}const mt=/^0x[a-fA-F0-9]/;function be(t){return mt.test(t.toString())}class pt extends l{constructor(e){super();const n=new $e.Keyring({type:"ethereum"});this._keyPair=n.addFromSeed(v.hexToU8a(e))}async getAddress(){return this._keyPair.address}async signMessage(e){const n=typeof e=="string"||e instanceof String?e:e.raw;return v.u8aToHex(this._keyPair.sign(n))}}const b=t=>wt(xt(t)),wt=t=>Array.from(t,e=>e.toString(16).padStart(2,"0")).join(""),xt=t=>new TextEncoder().encode(t),N=t=>new TextDecoder().decode(bt(t)),bt=t=>{const e=new Uint8Array(t.length/2);for(let n=0;n!==e.length;n++)e[n]=parseInt(t.substr(n*2,2),16);return e};class Se extends l{constructor(e){super(),this._walletClient=e}async getAddress(){var e;return(e=this._walletClient.account)==null?void 0:e.address}async signMessage(e){if(console.log(this._walletClient),!this._walletClient.signMessage)throw new Error("No signMessage on wallet client");return this._walletClient.signMessage({message:e})}}function St(t){const{signer:e}=t;return e instanceof l?e:new Se(t)}function q(t){return typeof t=="string"||t instanceof String?b(t):A.isHex(t.raw)?t.raw:b(v.u8aToString(t.raw))}function K(t){return typeof t=="string"||t instanceof String?t:A.isHex(t.raw)?N(t.raw):v.u8aToString(t.raw)}function X(t){const e=t.startsWith("0x")?t.slice(2):t,n=z.deriveAddress(e);if(!e.toLowerCase().startsWith("ed"))return[Z.ethereumEncode(`0x${e}`),n];const r=`0x${e}`;return[Z.ethereumEncode("0x"+A.keccak256(v.hexToU8a(`0x${r.slice(4)}`)).slice(26)),n]}class S extends l{constructor(e){super(),this._listeners={},this.client=e}async getAddress(){return await this.client.user.account}static async verifySignature(e,n){const s=K(e),r=I.decode(n),i=r.Memos;let o;if(i&&i.length>0&&(o=N(i[0].Memo.MemoData)),o!==s)throw new Error("Message does not match");if(typeof r.TxnSignature!="string"||!r.TxnSignature)throw new Error("Transaction is missing a signature, TxnSignature");if(typeof r.SigningPubKey!="string"||!r.SigningPubKey)throw new Error("Transaction is missing a public key, SigningPubKey");if(!z.verify(H.encodeForSigning(r),r.TxnSignature,r.SigningPubKey))throw new Error("Signature verification failed");const[c]=S.deriveAddressPair(r.SigningPubKey),u=r.Account;return{ethAddress:c,accounts:[c,u]}}verifySignedPayload(e){const n=I.decode(e),s=n.Account,[r]=S.deriveAddressPair(n.SigningPubKey);return{ethAddress:r,accounts:[r,s]}}verifySignature(e,n){return S.verifySignature(e,n)}async signXummPayload(e){if(!this.client.payload)throw new Error("No Xaman client payload");const{created:n,resolved:s}=await this.client.payload.createAndSubscribe(e,i=>{if(Object.keys(i.data).indexOf("opened")>-1,Object.keys(i.data).indexOf("signed")>-1){const{signed:o}=i.data;if(!o){this.emit("signed",{success:!1,uuid:i.uuid});return}const a=i.payload.response.hex;if(a==null)throw new Error("Transaction hex data was null after signing.");const c=this.decodeSignedPayload(a);return this.emit("signed",{success:!1,payload:c,uuid:i.uuid}),console.log("SIGNATURE",c),a}});return this.emit("showQR",n),await s}async signMessage(e){const n=q(e),s=[{Memo:{MemoType:b("message"),MemoData:n}}];return await this.signXummPayload({txjson:{Memos:s,TransactionType:"SignIn",AccountTxnID:"0000000000000000000000000000000000000000000000000000000000000000"},custom_meta:{instruction:"Sign message"}})}async signPassOIDC(e){const n=await this.signXummPayload({custom_meta:{instruction:"Sign In"},txjson:{TransactionType:"SignIn"}}),{ethAddress:s}=this.verifySignedPayload(n);return{hint:`xrpl:0x${this.decodeSignedPayload(n).SigningPubKey}:eoa:${s}:transaction:${n}`}}async signExtrinsicWithPayload(e,n,s,r){const{mortalLength:i}=await e.derive.tx.signingInfo(r),o=this.createSigningMemoData({nonce:s.trnPayload.nonce.toString(),genesisHash:s.trnPayload.genesisHash.toHex().slice(2),maxBlockNumber:+s.trnPayload.blockNumber+i,hashedExtrinsicWithoutPrefix:ae(n.toHex().slice(n.encodedLength>=66?8:6).toString())});return this.generateSignedExtrinsic(e,n,o)}async signExtrinsic(e,n,s){const r=await this.createSignatureOptions(e,s,n),i=this.createSigningMemoData(r);return this.generateSignedExtrinsic(e,n,i)}async generateSignedExtrinsic(e,n,s){const r=await this.signXummPayload({txjson:{Memos:s,TransactionType:"SignIn",AccountTxnID:"0000000000000000000000000000000000000000000000000000000000000000"},custom_meta:{instruction:"Sign extrinsic"}}),i=this.decodeSignedPayload(r),o=i.TxnSignature,a=i;return e.tx.xrpl.transact(`0x${I.encode(a)}`,`0x${o}`,n)}async createSignatureOptions(e,n,s){const[r,i]=await Promise.allSettled([e.query.system.number(),e.derive.tx.signingInfo(n)]);if(r.status==="rejected")throw r.reason;if(i.status==="rejected")throw i.reason;const o=i.value.nonce.toString(),a=e.genesisHash.toHex().slice(2),c=+r.value+i.value.mortalLength,u=ae(s.toHex().slice(s.encodedLength>=66?8:6).toString()),d={nonce:o,genesisHash:a,maxBlockNumber:c,hashedExtrinsicWithoutPrefix:u};return console.log("Xaman signing response",d),d}createSigningMemoData(e){const{nonce:n,genesisHash:s,maxBlockNumber:r,hashedExtrinsicWithoutPrefix:i}=e;return console.log(`${s}:${n}:${r}:0:${i}`),[{Memo:{MemoType:b("extrinsic"),MemoData:b(`${s}:${n}:${r}:0:${i}`)}}]}subscribe(e,n){var s;if(!this._listeners[e]){this._listeners[e]=[n];return}(s=this._listeners[e])==null||s.push(n)}unsubscribe(e,n){var s;this._listeners[e]&&(this._listeners[e]=(s=this._listeners[e])==null?void 0:s.filter(r=>r!==n))}emit(e,n){var s;this._listeners[e]&&((s=this._listeners[e])==null||s.forEach(r=>r(n)))}static decodeSignedPayload(e){return I.decode(e)}decodeSignedPayload(e){return S.decodeSignedPayload(e)}static deriveAddressPair(e){return X(e)}}const ae=t=>{t instanceof Buffer||(t=Buffer.from(t,"hex"));const e=O.blake2bInit(32);return O.blake2bUpdate(e,t),$t(O.blake2bFinal(e))},At=t=>t<16?`0${t.toString(16)}`:t.toString(16),$t=t=>Array.from(t).map(At).join("");class Et extends l{constructor(e){super(),this._account=e}async getAddress(){return this._account.address}async signMessage(e){return await this._account.signMessage({message:e})}}class Pt extends l{constructor(e,n,s){super(),this._pending=new Map,this._reqId=0,this._popup=null,this._signerURL=e,this._eoa=s,this._idpUrl=n;const r=new URL(this._signerURL).origin;this._listener=i=>{i.origin===r&&this.receiveMessage(i.data)},window&&window.addEventListener("message",this._listener)}receiveMessage(e){var s;const n=(s=this._pending.get(e.id))==null?void 0:s.handler;n==null||n(e)}async getAddress(){return this._eoa}async signMessage(e,n){if(!this._eoa)throw new Error("Must be signed in to sign message");const s=typeof e=="string"||e instanceof String?e:e.raw;return await this.makeRequest("signMessage",{tag:"fv/sign-msg",account:this._eoa,message:typeof s=="string"?s.startsWith("0x")?s:`0x${b(s)}`:A.toHex(s),idpUrl:this._idpUrl,metadata:{...n,requester:ce()}})}async signTransaction(e){if(!this._eoa)throw new Error("Must be signed in to sign message");return await this.makeRequest("signTransaction",{tag:"fv/sign-tx",account:this._eoa,transaction:e,idpUrl:this._idpUrl,metadata:{requester:ce()}})}makeRequest(e,n,s,r){const i="client:"+String(this._reqId++),{tag:o,...a}=n,c={id:i,tag:o,payload:a};let u=!1;const d=()=>{u||(u=!0,this._pending.delete(i))};return r==null||r.addEventListener("abort",d),new Promise((f,w)=>{const y=m=>{if(m.payload.tag==="event"){if(u||!s)return;s(m.payload.event);return}if(m.payload.tag==="response"){f(m.payload.response.signature),this._pending.delete(i),r==null||r.removeEventListener("abort",d);return}if(m.payload.tag==="error")return this._pending.delete(i),r==null||r.removeEventListener("abort",d),w(m.payload.error)};this._pending.set(i,{handler:y,tag:o}),this.postMessage(c)})}postMessage(e){var s;if(((s=this._popup)==null?void 0:s.closed)===!1){this._popup.postMessage(e,"*");return}if(this._popup=window.open(this._signerURL+"?request="+vt(JSON.stringify(e)),"futureverse_wallet","popup,right=0,width=480,height=496,menubar=no,toolbar=no,location=no,status=0"),this._popup==null)throw new Error("Failed to open popup");const n=setInterval(()=>{var r;(r=this._popup)!=null&&r.closed&&(clearInterval(n),this.cancelAll(),this._popup=null)},1e3)}cancelAll(){this._pending.forEach((e,n)=>{e.handler({id:n,tag:e.tag,payload:{tag:"error",error:{code:"USER_REJECTED"}}})}),this._pending.clear()}}function vt(t){return btoa(t||"").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"")}function ce(){try{return new URL(window.location.href).hostname}catch{return null}}class V extends l{constructor(e){super(),this.wallet=e}async signMessage(e){if(!this.wallet)throw new Error("XRPL wallet not found");const n=q(e),s=[{Memo:{MemoType:b("message"),MemoData:n}}],r={Account:this.wallet.classicAddress,TransactionType:"TicketCreate",TicketCount:1,Memos:s,AccountTxnID:"0000000000000000000000000000000000000000000000000000000000000000"};return this.wallet.sign(r).tx_blob}static async verifySignature(e,n){const s=K(e),r=H.decode(n),i=r.Memos;let o;if(i&&i.length>0){const d=i[0].Memo.MemoData;d&&(o=N(d))}if(o!==s)throw new Error("Message does not match");if(typeof r.TxnSignature!="string"||!r.TxnSignature)throw new Error("Transaction is missing a signature, TxnSignature");if(typeof r.SigningPubKey!="string"||!r.SigningPubKey)throw new Error("Transaction is missing a public key, SigningPubKey");if(!z.verify(H.encodeForSigning(r),r.TxnSignature,r.SigningPubKey))throw new Error("Signature verification failed");const[c]=X(r.SigningPubKey),u=r.Account;return{ethAddress:c,accounts:[c,u]}}verifySignature(e,n){return V.verifySignature(e,n)}async getAddress(){if(!this.wallet)throw new Error("XRPL wallet not found");return this.wallet.classicAddress}}exports.FutureverseCustodialSigner=Pt;exports.KeyringSigner=pt;exports.Signer=l;exports.ViemSigner=Et;exports.WalletSigner=Se;exports.XRPLSigner=V;exports.XamanSigner=S;exports.clientToSigner=St;exports.deriveAddressPair=X;exports.isValidSignature=be;exports.signableMessageToHex=q;exports.signableMessageToString=K;Object.keys(G).forEach(t=>{t!=="default"&&!Object.prototype.hasOwnProperty.call(exports,t)&&Object.defineProperty(exports,t,{enumerable:!0,get:()=>G[t]})});
